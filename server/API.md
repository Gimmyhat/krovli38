# API Документация

Документация по API серверной части проекта Krovli38.

## Базовый URL

```
http://localhost:3000/api
```

## Аутентификация

Большинство эндпоинтов требуют аутентификации с использованием JWT токена. Токен должен быть передан в заголовке `Authorization` в формате `Bearer <token>`.

### Получение токена

**Запрос:**
```
POST /api/auth/login
```

**Тело запроса:**
```json
{
  "email": "admin@krovli38.ru",
  "password": "admin123456"
}
```

**Ответ:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "_id": "60d21b4667d0d8992e610c85",
    "name": "Admin",
    "email": "admin@krovli38.ru",
    "role": "admin"
  }
}
```

## Заявки (Requests)

### Получение списка заявок

**Запрос:**
```
GET /api/requests
```

**Параметры запроса:**
- `page` (опционально): номер страницы (по умолчанию: 1)
- `limit` (опционально): количество записей на странице (по умолчанию: 10)
- `status` (опционально): фильтр по статусу заявки (new, processing, completed, rejected)
- `sort` (опционально): поле для сортировки (createdAt, updatedAt, status)
- `order` (опционально): порядок сортировки (asc, desc)

**Ответ:**
```json
{
  "requests": [
    {
      "_id": "60d21b4667d0d8992e610c85",
      "name": "Иван Иванов",
      "phone": "+7 (999) 123-45-67",
      "email": "ivan@example.com",
      "message": "Требуется ремонт кровли",
      "status": "new",
      "createdAt": "2023-06-24T12:00:00.000Z",
      "updatedAt": "2023-06-24T12:00:00.000Z"
    },
    // ...
  ],
  "pagination": {
    "total": 25,
    "page": 1,
    "limit": 10,
    "pages": 3
  }
}
```

### Получение заявки по ID

**Запрос:**
```
GET /api/requests/:id
```

**Ответ:**
```json
{
  "request": {
    "_id": "60d21b4667d0d8992e610c85",
    "name": "Иван Иванов",
    "phone": "+7 (999) 123-45-67",
    "email": "ivan@example.com",
    "message": "Требуется ремонт кровли",
    "status": "new",
    "createdAt": "2023-06-24T12:00:00.000Z",
    "updatedAt": "2023-06-24T12:00:00.000Z"
  }
}
```

### Создание новой заявки

**Запрос:**
```
POST /api/requests
```

**Тело запроса:**
```json
{
  "name": "Иван Иванов",
  "phone": "+7 (999) 123-45-67",
  "email": "ivan@example.com",
  "message": "Требуется ремонт кровли"
}
```

**Ответ:**
```json
{
  "message": "Заявка успешно создана",
  "request": {
    "_id": "60d21b4667d0d8992e610c85",
    "name": "Иван Иванов",
    "phone": "+7 (999) 123-45-67",
    "email": "ivan@example.com",
    "message": "Требуется ремонт кровли",
    "status": "new",
    "createdAt": "2023-06-24T12:00:00.000Z",
    "updatedAt": "2023-06-24T12:00:00.000Z"
  }
}
```

### Обновление статуса заявки

**Запрос:**
```
PATCH /api/requests/:id
```

**Тело запроса:**
```json
{
  "status": "processing"
}
```

**Ответ:**
```json
{
  "message": "Статус заявки обновлен",
  "request": {
    "_id": "60d21b4667d0d8992e610c85",
    "status": "processing",
    "updatedAt": "2023-06-25T10:30:00.000Z"
  }
}
```

### Удаление заявки

**Запрос:**
```
DELETE /api/requests/:id
```

**Ответ:**
```json
{
  "message": "Заявка успешно удалена"
}
```

## Пользователи (Users)

### Получение списка пользователей

**Запрос:**
```
GET /api/users
```

**Параметры запроса:**
- `page` (опционально): номер страницы (по умолчанию: 1)
- `limit` (опционально): количество записей на странице (по умолчанию: 10)

**Ответ:**
```json
{
  "users": [
    {
      "_id": "60d21b4667d0d8992e610c85",
      "name": "Admin",
      "email": "admin@krovli38.ru",
      "role": "admin",
      "createdAt": "2023-06-24T12:00:00.000Z"
    },
    // ...
  ],
  "pagination": {
    "total": 5,
    "page": 1,
    "limit": 10,
    "pages": 1
  }
}
```

### Получение пользователя по ID

**Запрос:**
```
GET /api/users/:id
```

**Ответ:**
```json
{
  "user": {
    "_id": "60d21b4667d0d8992e610c85",
    "name": "Admin",
    "email": "admin@krovli38.ru",
    "role": "admin",
    "createdAt": "2023-06-24T12:00:00.000Z"
  }
}
```

### Создание нового пользователя

**Запрос:**
```
POST /api/users
```

**Тело запроса:**
```json
{
  "name": "Новый пользователь",
  "email": "new@krovli38.ru",
  "password": "password123",
  "role": "manager"
}
```

**Ответ:**
```json
{
  "message": "Пользователь успешно создан",
  "user": {
    "_id": "60d21b4667d0d8992e610c85",
    "name": "Новый пользователь",
    "email": "new@krovli38.ru",
    "role": "manager",
    "createdAt": "2023-06-24T12:00:00.000Z"
  }
}
```

### Обновление пользователя

**Запрос:**
```
PATCH /api/users/:id
```

**Тело запроса:**
```json
{
  "name": "Обновленное имя",
  "role": "admin"
}
```

**Ответ:**
```json
{
  "message": "Пользователь успешно обновлен",
  "user": {
    "_id": "60d21b4667d0d8992e610c85",
    "name": "Обновленное имя",
    "role": "admin",
    "updatedAt": "2023-06-25T10:30:00.000Z"
  }
}
```

### Удаление пользователя

**Запрос:**
```
DELETE /api/users/:id
```

**Ответ:**
```json
{
  "message": "Пользователь успешно удален"
}
```

## Логи (Logs)

### Получение списка файлов логов

**Запрос:**
```
GET /api/logs/files
```

**Ответ:**
```json
{
  "files": [
    "error-2023-06-24.log",
    "combined-2023-06-24.log",
    "http-2023-06-24.log"
  ]
}
```

### Получение содержимого файла лога

**Запрос:**
```
GET /api/logs/content/:filename
```

**Ответ:**
```json
{
  "content": "2023-06-24T12:00:00.000Z [info]: Server running on port 3000\n2023-06-24T12:01:00.000Z [info]: Connected to MongoDB\n..."
}
```

### Очистка файла лога

**Запрос:**
```
DELETE /api/logs/clear/:filename
```

**Ответ:**
```json
{
  "message": "Файл лога успешно очищен"
}
```

## Коды ошибок

| Код  | Описание                                |
|------|----------------------------------------|
| 400  | Неверный запрос                         |
| 401  | Не авторизован                          |
| 403  | Доступ запрещен                         |
| 404  | Ресурс не найден                        |
| 500  | Внутренняя ошибка сервера               | 